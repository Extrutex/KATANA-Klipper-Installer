# KATANA-FLOW: START_PRINT Replacement
# Usage in slicer Start G-Code:
#   FLOW_START BED=60 NOZZLE=210
#
# Handles: Home → Heat → Park → Purge → Ready

[gcode_macro FLOW_START]
description: Complete print start sequence (KATANA-FLOW)
gcode:
    {% set bed_temp = params.BED|default(60)|int %}
    {% set nozzle_temp = params.NOZZLE|default(210)|int %}

    M117 KATANA-FLOW: Init
    G28                              ; Home all

    # Bed first, nozzle follows
    M140 S{bed_temp}                 ; Bed heat (non-blocking)
    M104 S150                        ; Pre-heat nozzle to prevent ooze

    M190 S{bed_temp}                 ; Wait for bed
    M109 S{nozzle_temp}              ; Wait for nozzle

    # Park near object, then purge
    FLOW_PARK
    FLOW_PURGE

    G92 E0
    M117 Printing
