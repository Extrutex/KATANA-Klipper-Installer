# KATANA-FLOW: X-Blade Purge
# Cross-pattern purge: two intersecting lines forming an X.
# Wipes in both directions â€” cleaner than a single line.
# Runs AFTER FLOW_PARK (nozzle already positioned).

[gcode_macro FLOW_PURGE]
description: X-Blade cross purge pattern (KATANA-FLOW)
gcode:
    {% set purge_len = params.LENGTH|default(30)|int %}
    {% set purge_amount = params.AMOUNT|default(12)|float %}
    {% set half = (purge_amount / 2)|float %}

    M117 FLOW: X-Blade Purge
    G92 E0
    G90

    # Drop to purge height
    G0 Z0.3 F3000

    # --- Stroke 1: forward-right diagonal ---
    G91
    G1 X{purge_len} Y{purge_len} E{half} F1500

    # Lift, return to start
    G0 Z0.5 F2000
    G0 X-{purge_len} Y-{purge_len} F6000
    G0 Z-0.5 F2000

    # --- Stroke 2: forward-left diagonal (forms X) ---
    G1 X-{purge_len} Y{purge_len} E{half} F1500

    # --- Wipe: drag across the X to snap the strand ---
    G0 Z0.5 F2000
    G1 E-0.3 F3000                  ; Micro-retract
    G0 X{purge_len * 0.5} F6000     ; Wipe right
    G0 Z2 F3000                     ; Clear

    G90
    G92 E0
    M117 FLOW: Primed
